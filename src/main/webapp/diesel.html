<!DOCTYPE html>
<html>

<head>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Di&eacute;sel | HCAM</title>
<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="font-awesome/css/font-awesome.css" rel="stylesheet">

<link href="css/plugins/chartist/chartist.min.css" rel="stylesheet">

<link href="css/plugins/iCheck/custom.css" rel="stylesheet">

<link href="css/plugins/chosen/chosen.css" rel="stylesheet">

<link href="css/plugins/colorpicker/bootstrap-colorpicker.min.css"
	rel="stylesheet">

<link href="css/plugins/cropper/cropper.min.css" rel="stylesheet">

<link href="css/plugins/switchery/switchery.css" rel="stylesheet">

<link href="css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">

<link href="css/plugins/nouslider/jquery.nouislider.css"
	rel="stylesheet">

<link href="css/plugins/datapicker/datepicker3.css" rel="stylesheet">

<link href="css/plugins/ionRangeSlider/ion.rangeSlider.css"
	rel="stylesheet">
<link href="css/plugins/ionRangeSlider/ion.rangeSlider.skinFlat.css"
	rel="stylesheet">

<link
	href="css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
	rel="stylesheet">

<link href="css/plugins/clockpicker/clockpicker.css" rel="stylesheet">

<link href="css/plugins/daterangepicker/daterangepicker-bs3.css"
	rel="stylesheet">

<link href="css/animate.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">

<link href="css/industrial.css" rel="stylesheet">

</head>

<body class="">

	<div id="wrapper">

		<nav class="navbar-default navbar-static-side" role="navigation">
			<div class="sidebar-collapse">
				<ul class="nav metismenu" id="side-menu">
					<li class="nav-header">
						<div class="dropdown profile-element">
							<span> <img alt="image" src="images/logo%20IESS.png"
								width="52" height="98" />
							</span> <a data-toggle="dropdown" class="dropdown-toggle" href="#">
								<span class="clear"> <span class="block m-t-xs"> <strong
										class="font-bold">HCAM</strong>
								</span></span>
							</a>
							<ul class="dropdown-menu animated fadeInRight m-t-xs">

								<li><a href="index.html">Salir</a></li>
							</ul>
						</div>
						<div class="logo-element">HCAM</div>
					</li>

					<li><a href="agua.html"><i class="fa fa-tint"></i> <span class="nav-label">AGUA POTABLE</span></a></li>
					<li class="active"><a href="diesel.html"><i class="fa fa-truck"></i> <span class="nav-label">DI&Eacute;SEL</span></a></li>
					<li><a href="vapor.html"><i class="fa fa-fire"></i> <span class="nav-label">VAPOR</span> </a></li>
				</ul>

			</div>
		</nav>

		<div id="page-wrapper" class="gray-bg">
			<div class="row border-bottom">
				<nav class="navbar navbar-static-top  " role="navigation"
					style="margin-bottom: 0">
					<div class="navbar-header">
						<a class="navbar-minimalize minimalize-styl-2 btn btn-primary "
							href="#"><i class="fa fa-bars"></i> </a>
					</div>
					<ul class="nav navbar-top-links navbar-right">
						<li><span class="m-r-sm text-muted welcome-message">Monitoreo Casa de M&aacute;quinas</span></li>
						<li><a href="estadistica_diesel.jsp"> <i
								class="fa fa-table"></i> Estad&iacute;stica
						</a></li>
						<li><a href="index.html"> <i class="fa fa-sign-out"></i>
								Salir
						</a></li>
					</ul>

				</nav>
			</div>
			<div class="wrapper wrapper-content">

				<div class="row  border-bottom white-bg dashboard-header">

					<div class="col-sm-3">
						<h2><strong>ALARMAS</strong></h2>
						<div id="alarma" class="widget red-bg p-lg text-center">
							<div class="m-b-md">
								<i class="fa fa-warning fa-4x"></i>
								<h1 class="m-xs">Alarma</h1>
								<h3 class="font-bold no-margins" id="texto_estado_alarma">
									FALLA DE SISTEMA</h3>
								<small></small>
							</div>
						</div>
						<small>Espacio para las alarmas</small>

					</div>
					<div class="col-sm-6">
						<h2 align="center" id="fecha"></h2>
						<div class="ibox-content ibox-heading">
							<h3><strong>ESTADO DEL SISTEMA</strong></h3>
							<h3 id="texto_cuadro_dialogo">OPERACI&Oacute;N NORMAL</h3>
						</div>

						<div class="ibox-content">
							<h3><strong>INDICACIONES</strong></h3>

							<h3 id="texto_indicacion_alarma"></h3>
							<p></p>

						</div>


					</div>
					<div class="col-sm-3">
						<h2><strong>NOTIFICACIONES</strong></h2>
						<div id="notificacion" class="widget yellow-bg p-lg text-center">
							<div class="m-b-md">
								<i class="fa fa-bell fa-4x"></i>
								<h3 id="texto_notificacion" class="font-bold no-margins">NOTIFICACI&Oacute;N</h3>
								
							</div>
						</div>
						<small>Espacio para las notificaciones</small>

					</div>

				</div>
				<div class="row">

					<div class="col-lg-6">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5 class="no-margins"  id="tanque1">TANQUE 1</h5>
							</div>
							<div class="ibox-content">
								<div class="text-center">
									<!--OJO-->
									<center>
										<div class="industrial tank size four" id="total_galont1">
											<span class="ticks" data-amount="6" data-scale-freq="1"></span>
											<div class="space"></div>
											<div class="meter"></div>
										</div>
									</center>
									<h2 align="center" id="texto_tanque1"></h2>
								</div>
							</div>
						</div>
					</div>
					<div class="col-lg-6">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5 class="no-margins"  id="tanque2">TANQUE 2</h5>
							</div>
							<div class="ibox-content">
								<center>
									<div class="industrial tank size four" id="total_galont2">
										<span class="ticks" data-amount="6" data-scale-freq="1"></span>
										<div class="space"></div>
										<div class="meter"></div>
									</div>
								</center>
								<h2 align="center" id="texto_tanque2"></h2>
							</div>
						</div>
					</div>

				</div>
				<div class="row">

					<div class="col-lg-4">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>BOMBA DE INGRESO</h5>
							</div>
							<div class="ibox-content">
								<center>
									<img id="bomba_ingreso" width="320" height="200"
										src="images/bomba_parada.png">
								</center>
								<center>
									<h4 class="no-margins" id="galones_entrada"></h4>
									<h4 class="no-margins" id="flujo_entrada"></h4>
									<!--OJO-->
									<h5 class="no-margins" id="texto_bomba1">APAGADA</h5>
								</center>
							</div>
						</div>
					</div>
					<div class="col-lg-4">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>BOMBA DE SALIDA</h5>
							</div>
							<div class="ibox-content">

								<center>
									<img id="bomba_tdiario" width="320" height="200" src="images/bomba_parada.png">
								</center>
								<center>
									<h4 class="no-margins" id="galones_salida"></h4>
									<h4 class="no-margins" id="flujo_salida"></h4>
									<!--OJO-->
									<h5 class="no-margins" id="texto_bomba2">APAGADA</h5>
								</center>
							</div>
						</div>
					</div>
					<div class="col-lg-4">
						<div class="ibox float-e-margins">
							<div class="ibox-title">
								<h5>TEMPERATURA DI&Eacute;SEL AL MOMENTO DEL INGRESO</h5>
							</div>
							<div class="ibox-content">
								<center>
									<div class="industrial thermometer size two" id="valor_total_temperatura">
										<span class="ticks" data-amount="5" data-scale-freq="1"></span>
										<div class="space"></div>
										<div class="meter"></div>
									</div>
								</center>
								<h2 align="center" id="texto_temperatura"></h2>

							</div>
						</div>
					</div>

				</div>
			</div>
			<div class="footer">
				<div>
					<strong>Copyright</strong> Escuela Polit&eacute;cnica Nacional - FIEE &copy; 2014-2015
				</div>
			</div>

		</div>
	</div>
	<!-- Chartist -->
	<script src="js/plugins/chartist/chartist.min.js"></script>
	<!-- Mainly scripts -->
	<script src="js/jquery-2.1.1.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
	<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

	<!-- Custom and plugin javascript -->
	<script src="js/inspinia.js"></script>
	<script src="js/plugins/pace/pace.min.js"></script>

	<script src="js/industrial.js"></script>

	<script>
		var banAlarmas = false;

		$(document).ready(function() {
			setTimeout(function() {
				$("#total_galont1").industrial({
					default_value : true, //Strating value for component
					low : 0, //Scale lower boundary
					high : 6000, //Scale upper boundary
					tick_scale : false, //Add numerical scales to tick marks?
					tick_scale_frequency : 1,//Frequency of numerical scales
					tick_amount : 0, //Amount of tick marks on component
					tick_height : 3, //Percent height of each tick mark
					digit_amount : 4, //Amount of digital readout digits
				});
				$("#total_galont2").industrial({
					default_value : true, //Strating value for component
					low : 0, //Scale lower boundary
					high : 6000, //Scale upper boundary
					tick_scale : false, //Add numerical scales to tick marks?
					tick_scale_frequency : 1,//Frequency of numerical scales
					tick_amount : 0, //Amount of tick marks on component
					tick_height : 3, //Percent height of each tick mark
					digit_amount : 4, //Amount of digital readout digits
				});
				$("#valor_total_temperatura").industrial({
					default_value : false, //Strating value for component
					low : 0, //Scale lower boundary
					high : 60, //Scale upper boundary
					tick_scale : true, //Add numerical scales to tick marks?
					tick_scale_frequency : 1,//Frequency of numerical scales
					tick_amount : 0, //Amount of tick marks on component
					tick_height : 1, //Percent height of each tick mark
					digit_amount : 1, //Amount of digital readout digits
				});
			}, 250);
		});
		$("#alarma").hide();
		$("#notificacion").hide();

		var refreshId = setInterval(function() {
			actualizarTanques();
			//console.log(banAlarmas)
			//actualizarEstadoBombas();
			//console.log(banAlarmas)
			actualizarFecha();
			banAlarmas = false;
		}, 2000);
		$.ajaxSetup({ cache : false	});

		function actualizarTanques() {
			$.get('ActualizarTanques', {
				"rand" : Math.random()
			}, function(resp) { // on sucess
				var volument1 = 0;
				var volument2 = 0;
				var alarma_bajo_tanque1 = 0;
				var alarma_bajo_tanque2 = 0;
				var alarma_alto_tanque1 = 0;
				var alarma_alto_tanque2 = 0;
				var alarma_paro_emergencia = 0;
				var pedido_tanque = 0;
				var modo_ingreso = 0;
				var tanque_uso_indicador = 0;
				var textos_alarmas = "";
				var indicaciones_alarmas = "";
				var dialogos_alarmas = "";
				var valor_galones_entrada = 0;
				var valor_flujo_entrada = 0;
				var valor_galones_salida = 0;
				var valor_flujo_salida = 0;
				var bomba_ingreso_funcionando = false;
				var bomba_salida_funcionando = false;
				
				$.each(resp, function(nombre, valor) {
					if (nombre == "valor_total_tanque1") {
						$("#texto_tanque1").html(valor + " Galones");
						$("#total_galont1").industrial(valor);
						volument1 = valor;
					}
					if (nombre == "valor_total_tanque2") {
						$("#texto_tanque2").html(valor + " Galones");
						$("#total_galont2").industrial(valor);
						volument2 = valor;
					}
					if (nombre == "valor_total_temperatura") {
						$("#texto_temperatura").html(valor + "&#176; C");
						$("#valor_total_temperatura").industrial(valor);
					}
					if (nombre == "valor_total_entrada") {
						valor_galones_entrada = valor;
					}
					if (nombre == "valor_flujo_entrada") {
						valor_flujo_entrada = valor;
					}
					if (nombre == "valor_total_salida") {
						valor_galones_salida = valor;
						
					}
					if (nombre == "valor_flujo_salida") {
						valor_flujo_salida = valor;
						
					}
					if (nombre == "bomba_ingreso") {
						if (valor == 10) {
							bomba_ingreso_funcionando = true;
						} 
					}
					if (nombre == "bomba_tdiario") {
						if (valor == 10) {
							bomba_salida_funcionando = true;
						}
					}
					if (nombre == "bajo_tanque1") {
						alarma_bajo_tanque1 = valor;	
					}
					if (nombre == "alto_tanque1") {
						alarma_alto_tanque1 = valor;
					}
					if (nombre == "bajo_tanque2") {
						alarma_bajo_tanque2 = valor;
					}
					if (nombre == "alto_tanque2") {
						alarma_alto_tanque2 = valor;
					}
					if (nombre == "paro_emergencia") {
						alarma_paro_emergencia = valor;
					}
					if (nombre == "pedido_tanque") {
						pedido_tanque = valor;
					}
					if (nombre == "tanque_uso") {
						tanque_uso_indicador = valor;
					}
					if (nombre == "modo") {
						modo_ingreso = valor;
					}
				});
				if (alarma_bajo_tanque1 == 10) {
					banAlarmas = true;
					textos_alarmas = "Nivel Bajo Tanque 1";
					dialogos_alarmas = "Tanque 1 a alcanzado su Nivel m&aacute;s Bajo";
					indicaciones_alarmas = "Debe entrar en operaci&oacute;n el Tanque 2";
				}
				if (alarma_alto_tanque1 == 10) {
					banAlarmas = true;
					textos_alarmas = textos_alarmas+"<br/>Nivel Alto Tanque 1";
					dialogos_alarmas = dialogos_alarmas+"<br/>Tanque 1 a alcanzado su Nivel m&aacute;s Alto";
					indicaciones_alarmas = indicaciones_alarmas+"<br/>Habilitar ingreso combustible Tanque 2, reiniciar sistema";
				}
				if (alarma_bajo_tanque2 == 10) {
					banAlarmas = true;
					textos_alarmas = textos_alarmas+"<br/>Nivel Bajo Tanque 2";
					dialogos_alarmas = dialogos_alarmas+"<br/>Tanque 2 a alcanzado su Nivel m&aacute;s Bajo";
					indicaciones_alarmas = indicaciones_alarmas+"<br/>Debe entrar en operaci&oacute;n el Tanque 1";
				}
				if (alarma_alto_tanque2 == 10) {
					banAlarmas = true;
					textos_alarmas = textos_alarmas+"<br/>Nivel Alto Tanque 2";
					dialogos_alarmas = dialogos_alarmas+"<br/>Tanque 2 a alcanzado su Nivel m&aacute;s Alto";
					indicaciones_alarmas = indicaciones_alarmas+"<br/>Habilitar ingreso combustible Tanque 1, reiniciar sistema";
				}
				if (alarma_paro_emergencia == 10) {
					banAlarmas = true;
					textos_alarmas = textos_alarmas+"<br/>PARO DE EMERGENCIA";
					dialogos_alarmas = dialogos_alarmas+"<br/>EMERGENCIA EN EL SISTEMA";
					indicaciones_alarmas = indicaciones_alarmas+"<br/>Atender la emergencia existente en el sistema";
				}
				if (banAlarmas){
					$("#alarma").show();
					$("#texto_estado_alarma").html(textos_alarmas);
					$("#texto_cuadro_dialogo").html(dialogos_alarmas);
					$("#texto_indicacion_alarma").html(indicaciones_alarmas);	
				}
				if(alarma_bajo_tanque1 == 20 && alarma_alto_tanque1 == 20 && alarma_bajo_tanque2 == 20 && alarma_alto_tanque2 == 20 && alarma_paro_emergencia == 20){
					$("#alarma").hide();
					$("#notificacion").hide();
				}
				if(pedido_tanque == 1 && volument1 <= 800){
					$("#notificacion").show();
					$("#texto_notificacion").html("Realizar el pedido de reabastecimiento de combustible para el Tanque1");
				}
				if(pedido_tanque == 2 && volument2 <= 800){
					$("#notificacion").show();
					$("#texto_notificacion").html("Realizar el pedido de reabastecimiento de combustible para el Tanque2");
				}
				if (tanque_uso_indicador == 1){
					$("#tanque1").html("TANQUE 1 EN OPERACI&Oacute;N");
				}
				if (tanque_uso_indicador == 2){
					$("#tanque2").html("TANQUE 2 EN OPERACI&Oacute;N");
				}
				if (modo_ingreso == 2){
					$("#texto_cuadro_dialogo").html("Bomba de ingreso en modo de autom&aacute;tico");
				}
				if (modo_ingreso == 3){
					$("#texto_cuadro_dialogo").html("Bomba de ingreso en modo de manual");
				}
				if(alarma_bajo_tanque2 && volument1 <= 300){
					$("#texto_indicacion_alarma").html("Racionalizar el consumo de combustible");
				}
				if(alarma_bajo_tanque1 && volument2 <= 300){
					$("#texto_indicacion_alarma").html("Racionalizar el consumo de combustible");
				}
				if (bomba_ingreso_funcionando == true) {
					$("#bomba_ingreso").attr("src",
							"images/bomba_funcionando.gif");
					$("#texto_bomba1").html("FUNCIONANDO");
					$("#galones_entrada").html(valor_galones_entrada + " Galones");
					$("#flujo_entrada").html(valor_flujo_entrada + " GPM");
				} else {
					$("#bomba_ingreso").attr("src",
							"images/bomba_parada.png");
					$("#texto_bomba1").html("APAGADA");
					$("#galones_entrada").html("");
					$("#flujo_entrada").html("");
				}
				if (bomba_salida_funcionando == true) {
					$("#bomba_tdiario").attr("src",
							"images/bomba_funcionando.gif");
					$("#texto_bomba2").html("FUNCIONANDO");
					$("#galones_salida").html(valor_galones_salida + " Galones");
					$("#flujo_salida").html(valor_flujo_salida + " GPM");
				} else {
					$("#bomba_tdiario").attr("src",
							"images/bomba_parada.png");
					$("#texto_bomba2").html("APAGADA");
					$("#galones_salida").html("");
					$("#flujo_salida").html("");
				}

			}).fail(function() { //on failure
				alert("Falló la petición");
			});
		}
		/*function actualizarEstadoBombas() {
			$.get(
					'ActualizarEstadoBombasDiesel',
					{
						"rand" : Math.random()
					},
					function(resp) { //on sucess
						$.each(resp, function(nombre, valor) {
							if (nombre == "bomba_ingreso") {
								if (valor == 10) {
									$("#bomba_ingreso").attr("src",
											"images/bomba_funcionando.gif");
									$("#texto_bomba1").html("FUNCIONANDO");
								} else {
									$("#bomba_ingreso").attr("src",
											"images/bomba_parada.png");
									$("#texto_bomba1").html("APAGADA");
								}
							}
							if (nombre == "bomba_tdiario") {
								if (valor == 10) {
									$("#bomba_tdiario").attr("src",
											"images/bomba_funcionando.gif");
									$("#texto_bomba2").html("FUNCIONANDO");
								} else {
									$("#bomba_tdiario").attr("src",
											"images/bomba_parada.png");
									$("#texto_bomba2").html("APAGADA");
								}
							}
						});
					}).fail(function() { //on failure
				alert("Falló");
			});
		}
*/
		function actualizarFecha() {
			var monthNames = [ "Enero", "Febrero", "Marzo", "Abril", "Mayo",
					"Junio", "Julio", "Agosto", "Septiembre", "Octubre",
					"Noviembre", "Diciembre" ];

			var date = new Date();
			var day = date.getDate();
			var monthIndex = date.getMonth();
			var year = date.getFullYear();
			var hour = date.getHours();
			var minutes = date.getMinutes();
			$("#fecha").html(
					day + "-" + monthNames[monthIndex] + "-" + year + " "
							+ hour + ":" + minutes);
		}
	</script>


</body>

</html>
